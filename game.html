<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        canvas {
            border:1px solid #d3d3d3;
            background-color: #f1f1f1;
            align-self: center;
        }
        body{
            text-align:center;
        }
    </style>
</head>

<script>

    window.addEventListener('keydown', function(event) {
        switch (event.keyCode) {
            case 37: // Left
                moveleft();
                break;
            case 39: // Right
                moveright();
                break;

        }
    }, false);

    window.addEventListener('keyup', function(event) {
        switch (event.keyCode) {
            case 37: // Left
                clearmove();
                break;
            case 39: // Right
                clearmove();
                break;

        }
    }, false);

    let myPlatform;
    let myBall;
    let interval;
    var bricks=[];
    let isPaused=false;
    let isEnd= false;

    function loadMap(){
        bricks = [
            new Brick(50,50,50,30,"blue"),
            new Brick(101,50,50,30,"blue"),
            new Brick(152,50,50,30,"blue"),
            new Brick(203,50,50,30,"blue"),
            new Brick(254,50,50,30,"blue"),
            new Brick(305,50,50,30,"blue"),
            new Brick(356,50,50,30,"blue"),
            new Brick(407,50,50,30,"blue"),
            new Brick(458,50,50,30,"blue"),
            new Brick(509,50,50,30,"blue"),


            new Brick(50,81,50,30,"green"),
            new Brick(101,81,50,30,"green"),
            new Brick(152,81,50,30,"green"),
            new Brick(203,81,50,30,"green"),
            new Brick(254,81,50,30,"green"),
            new Brick(305,81,50,30,"green"),
            new Brick(356,81,50,30,"green"),
            new Brick(407,81,50,30,"green"),
            new Brick(458,81,50,30,"green"),
            new Brick(509,81,50,30,"green"),

            new Brick(50,112,50,30,"darkcyan"),
            new Brick(101,112,50,30,"darkcyan"),
            new Brick(152,112,50,30,"darkcyan"),
            new Brick(203,112,50,30,"darkcyan"),
            new Brick(254,112,50,30,"darkcyan"),
            new Brick(305,112,50,30,"darkcyan"),
            new Brick(356,112,50,30,"darkcyan"),
            new Brick(407,112,50,30,"darkcyan"),
            new Brick(458,112,50,30,"darkcyan"),
            new Brick(509,112,50,30,"darkcyan")
        ];
    }

    function Brick(x,y,width,height,color){
        var isAlive = true;
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.color = color;
        this.update=function(){
            if(isAlive===true) {
                ctx = myGameArea.context;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }
        }

    }

    function startGame() {

        if(isPaused===false||isEnd===true){
            loadMap();
            isEnd = false;
            isPaused=false;
            clearInterval(interval);
            myPlatform = new component(150, 20, "blue", 200, 360);
            myBall = new ball(10,"green",100,150);
            myGameArea.start();
        }else {
            isPaused=false;
        }

    }
    const myGameArea = {
        canvas : document.createElement("canvas"),
        start : function() {
            this.canvas.width = 600;
            this.canvas.height = 400;
            this.canvas.style= "text-align:center";
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            interval = setInterval(updateGameArea, 20);
        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);

        }
    }

    function component(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
        this.update = function() {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        this.newPos = function() {
            this.x += this.speedX;
            this.y += this.speedY;
        }
    }

    function ball(r, color, x, y) {
        this.radious=r;
        this.speedX = 5;
        this.speedY = 5;
        this.x = x;
        this.y = y;
        this.update = function() {
            const ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.radious,0,2*Math.PI);
            ctx.fill();
        }
        this.newPos = function() {
            this.x += this.speedX;
            this.y += this.speedY;
        }
        this.collisionPlatform= function(x, y, width){
            if((this.y===y-this.radious)&&((this.x<x+width)&&(this.x>x))){
                this.speedY=(-1)*this.speedY;
            }
        }
        this.collisionBall = function() {
            if(this.y===20){
               this.speedY=(-1)*this.speedY;
            }
            if((this.x===600)||(this.x===10)){
                this.speedX=(-1)*this.speedX;
            }
        }
        this.collisionDown=function(){
            if(this.y>400){
                ctx.font = "40px Arial";
                ctx.fillStyle="red";
                ctx.fillText("Koniec gry", 250, 200);
                isEnd = true;
                clearInterval(interval);
            }
        }
        this.checkBallColisionWithBrick=function(bricks){
            bricks.forEach((brick) => {
                    if((this.y<brick.y+brick.height)&&(this.y>brick.y)&&(this.x>brick.x)&&(this.x<brick.x+brick.width)){
                        this.speedX=(-1)*this.speedX;
                        brick.isAlive=false;
                    }
                    if((this.x<brick.x+brick.width)&&(this.x>brick.x)&&(this.y>brick.y)&&(this.y<brick.y+brick.height)) {
                        this.speedY = (-1) * this.speedY;
                        brick.isAlive = false;
                    }
            });
        }
    }

    function updateGameArea() {
        if(isPaused===false){
            myGameArea.clear();
            bricks.forEach((brick)=>{
                brick.update();
            });
            myBall.collisionBall();
            myBall.collisionPlatform(myPlatform.x,myPlatform.y,myPlatform.width);
            myBall.checkBallColisionWithBrick(bricks);
            myBall.newPos();
            myBall.update();
            myPlatform.newPos();
            myPlatform.update();
            myBall.collisionDown();
        }else {
            ctx.font = "40px Arial";
            ctx.fillStyle="red";
            ctx.fillText("Stop", 250, 200);
        }

    }

    function moveleft() {
        myPlatform.speedX = -5;
    }

    function moveright() {
        myPlatform.speedX = 5;

    }

    function clearmove() {
        myPlatform.speedX = 0;
        myPlatform.speedY = 0;
    }

    function pauseGame(){
      isPaused=true;
    }

</script>
<br>
<button onmousedown="moveleft()" onmouseup="clearmove()" ontouchstart="moveleft()">Lewo</button>
<button onmousedown="moveright()" onmouseup="clearmove()" ontouchstart="moveright()">Prawo</button>
<button onmousedown="startGame()" onmouseup="clearmove()" ontouchstart="startGame()">Start</button>
<button onmousedown="pauseGame()" onmouseup="clearmove()" ontouchstart="pauseGame()">Stop</button>

</body>
</html>