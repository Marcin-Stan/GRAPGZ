<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        canvas {
            border:1px solid #d3d3d3;
            background-color: #f1f1f1;
            align-self: center;
        }
        body{
            text-align:center;
        }
    </style>
</head>

<script>

    window.addEventListener('keydown', function(event) {
        switch (event.keyCode) {
            case 37: // Left
                moveleft();
                break;
            case 39: // Right
                moveright();
                break;
			case 40:
				movedown();
				break;
			case 38:
				moveup();
				break;

        }
    }, false);

    window.addEventListener('keyup', function(event) {
        switch (event.keyCode) {
            case 37: // Left
                clearmove();
                break;
            case 39: // Right
                clearmove();
                break;
			case 40:
				clearmove2();
				break;
			case 38:
				clearmove2();
				break;

        }
    }, false);

    let myPlatform;
	let myPlatform2;
    let myBall;
    let interval;
    var bricks=[];
    let isPaused=false;
    let isEnd= false;
    let points=0;
	let isSidePlatform=false;
    
    function loadMap(){
        bricks = [
            new Brick(50,50,50,30,"blue"),
            new Brick(101,50,50,30,"blue"),
            new Brick(152,50,50,30,"blue"),
            new Brick(203,50,50,30,"blue"),
            new Brick(254,50,50,30,"blue"),
            new Brick(305,50,50,30,"blue"),
            new Brick(356,50,50,30,"blue"),
            new Brick(407,50,50,30,"blue"),
            new Brick(458,50,50,30,"blue"),
            new Brick(509,50,50,30,"blue"),

            new Brick(50,81,50,30,"green"),
            new Brick(101,81,50,30,"green"),
            new Brick(152,81,50,30,"green"),
            new Brick(203,81,50,30,"green"),
            new Brick(254,81,50,30,"green"),
            new Brick(305,81,50,30,"green"),
            new Brick(356,81,50,30,"green"),
            new Brick(407,81,50,30,"green"),
            new Brick(458,81,50,30,"green"),
            new Brick(509,81,50,30,"green"),

            new Brick(50,112,50,30,"darkcyan"),
            new Brick(101,112,50,30,"darkcyan"),
            new Brick(152,112,50,30,"darkcyan"),
            new Brick(203,112,50,30,"darkcyan"),
            new Brick(254,112,50,30,"darkcyan"),
            new Brick(305,112,50,30,"darkcyan"),
            new Brick(356,112,50,30,"darkcyan"),
            new Brick(407,112,50,30,"darkcyan"),
            new Brick(458,112,50,30,"darkcyan"),
            new Brick(509,112,50,30,"darkcyan")
        ];
    }

    function Brick(x,y,width,height,color){
        this.x = x;
        this.y = y;
        this.width = width;
        this.height = height;
        this.color = color;
        this.update=function(){
            ctx = myGameArea.context;
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
    }

    function startGame() {
            points=0;
        if(isPaused===false||isEnd===true){
            loadMap();
            isEnd = false;
            isPaused=false;
            clearInterval(interval);
            myPlatform = new component(150, 20, "blue", 200, 360);
			myPlatform2= new component(20, 150, "blue", 10, 100);
            myBall = new ball(10,"green",100,170);
            myGameArea.start();
        }else {
            isPaused=false;
        }

    }
    const myGameArea = {
        canvas : document.createElement("canvas"),
        start : function() {
            this.canvas.width = 600;
            this.canvas.height = 400;
            this.canvas.style= "text-align:center";
            this.context = this.canvas.getContext("2d");
            document.body.insertBefore(this.canvas, document.body.childNodes[0]);
            interval = setInterval(updateGameArea, 20);

        },
        clear : function() {
            this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);

        }
    }

    function component(width, height, color, x, y) {
        this.width = width;
        this.height = height;
        this.speedX = 0;
        this.speedY = 0;
        this.x = x;
        this.y = y;
        this.update = function() {
            ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
        }
        this.newPos = function() {
            this.x += this.speedX;
            this.y += this.speedY;
        }
    }

    function ball(r, color, x, y) {
        this.radious=r;
        this.startSpeed=5;
        this.speedX = 5;
        this.speedY = 5;
        this.x = x;
        this.y = y;
        this.update = function() {
            const ctx = myGameArea.context;
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(this.x,this.y,this.radious,0,2*Math.PI);
            ctx.fill();

            ctx.font = "25px Arial";
            ctx.fillStyle="red";
            ctx.fillText(points, 10, 35);
        }
        this.newPos = function() {
            this.x += this.speedX;
            this.y += this.speedY;
        }
        this.collisionPlatform= function(x, y, width){
            if((this.y>=y-this.radious)&&((this.x<=x+width)&&(this.x>=x))){
                this.speedY=(-1)*this.speedY;
                platformPiece=myPlatform.width/10;
                vector=this.speedX/Math.abs(this.speedX)
                switch(true){
                    case this.x<x+platformPiece:
                        this.speedX=this.startSpeed*3;
                        break;
                    case this.x<x+3*platformPiece:
                        this.speedX=this.startSpeed*2;
                        break;
                    case this.x<x+4*platformPiece:
                        this.speedX=this.startSpeed*1.5;
                        break;
                    case this.x<x+6*platformPiece:
                        this.speedX=this.startSpeed;
                        break;
                    case this.x<x+7*platformPiece:
                        this.speedX=this.startSpeed*1.5;
                        break;
                    case this.x<x+9*platformPiece:
                        this.speedX=this.startSpeed*2;
                        break;
                    case this.x<x+width:
                        this.speedX=this.startSpeed*3;
                        break;
                    default:
                        this.speedX=this.speedY;
                }
                this.speedX=this.speedX*vector;
            }
        }
		
		this.collisionPlatform2= function(x, y, width,height){
            if((this.x<=x-this.radious+width)&&((this.y<=y+height)&&(this.y>=y))){
                this.speedX=(-1)*this.speedX;
                platformPiece=myPlatform2.height/10;
                vector=this.speedY/Math.abs(this.speedY)
                switch(true){
                    case this.x<x+platformPiece:
                        this.speedY=this.startSpeed*3;
                        break;
                    case this.x<x+3*platformPiece:
                        this.speedY=this.startSpeed*2;
                        break;
                    case this.x<x+4*platformPiece:
                        this.speedY=this.startSpeed*1.5;
                        break;
                    case this.x<x+6*platformPiece:
                        this.speedY=this.startSpeed;
                        break;
                    case this.x<x+7*platformPiece:
                        this.speedY=this.startSpeed*1.5;
                        break;
                    case this.x<x+9*platformPiece:
                        this.speedY=this.startSpeed*2;
                        break;
                    case this.x<x+width:
                        this.speedY=this.startSpeed*3;
                        break;
                    default:
                        this.speedY=this.speedY;
                }
                this.speedY=this.speedY*vector;
            }
        }
		
        this.collisionBall = function() {
            if(this.y<=0){
                this.speedY=(-1)*this.speedY;
            }
            if((this.x>=600)||(!isSidePlatform&&(this.x<=0))){
                this.speedX=(-1)*this.speedX;
            }
        }
        this.collisionDown=function(){
            if((this.y>400)||(this.x<-5)){
                ctx.font = "40px Arial";
                ctx.fillStyle="red";
                ctx.fillText("Koniec gry", 250, 200);
                isEnd = true;
                clearInterval(interval);
                points=0;
            }
        }
        this.checkBallColisionWithBrick=function(bricks){

            for(let i=0; i<bricks.length; i++){

                if(((this.y-this.radious<=bricks[i].y+bricks[i].height)
                    &&(this.y+this.radious>=bricks[i].y))
                    &&(this.x>=bricks[i].x)
                    &&(this.x<=bricks[i].x+bricks[i].width)){

                    bricks.splice(i,1);
                    this.speedY = (-1) * this.speedY;
                    points++;

                }else{
                    if(((this.x-this.radious<=bricks[i].x+bricks[i].width)
                        &&(this.x+this.radious>=bricks[i].x))
                        &&(this.y<=bricks[i].y+bricks[i].height)
                        &&(this.y>=bricks[i].y)){

                        bricks.splice(i,1);
                        this.speedX = (-1) * this.speedX;
                        points++;
                    }
                }
            }

        }

        this.checkEndOfBricks=function(bricks){
            if(bricks.length===0){
                ctx.font = "30px Arial";
                ctx.fillStyle="red";
                ctx.fillText("Koniec poziomu", 180, 200);
                isEnd = true;
                clearInterval(interval);
                points=0;
            }
        }

    }

    function updateGameArea() {
        if(isPaused===false){
            myGameArea.clear();
            bricks.forEach((brick)=>{
                brick.update();
            });
            myBall.collisionBall();
            myBall.collisionPlatform(myPlatform.x,myPlatform.y,myPlatform.width);
			if(isSidePlatform){
				myBall.collisionPlatform2(myPlatform2.x,myPlatform2.y,myPlatform2.width, myPlatform2.height);
            }
			myBall.checkBallColisionWithBrick(bricks);
            myBall.checkEndOfBricks(bricks);
            myBall.newPos();
            myBall.update();
			
            checkPlatformEdgePadding();
            myPlatform.newPos();
            myPlatform.update();
			if(isSidePlatform){
				myPlatform2.newPos();
				myPlatform2.update();
            }
			myBall.collisionDown();
        }else {
            ctx.font = "40px Arial";
            ctx.fillStyle="red";
            ctx.fillText("Stop", 250, 200);
        }

    }

    function checkPlatformEdgePadding(){
        if((myPlatform.x+myPlatform.width>=595&&(myPlatform.speedX>0))||(myPlatform.x<=5&&(myPlatform.speedX<0))){
            myPlatform.speedX=0;
        }
		if((myPlatform2.y+myPlatform2.height>=395&&(myPlatform2.speedY>0))||(myPlatform2.y<=5&&(myPlatform2.speedY<0))){
            myPlatform2.speedY=0;
        }
    }

    function moveleft() {
        myPlatform.speedX = -5;

    }

    function moveright() {
        myPlatform.speedX = 5;

    }
	function moveup(){
	myPlatform2.speedY=-5;
	}
	function movedown(){
	myPlatform2.speedY=5;
	}

    function clearmove() {
        myPlatform.speedX = 0;
        myPlatform.speedY = 0;
    }
	function clearmove2(){
		myPlatform2.speedX=0;
		myPlatform2.speedY=0;
		}

    function pauseGame(){
        isPaused=true;
    }
	function toogleSidePlatform(){
		isSidePlatform=!isSidePlatform;
		startGame();
	}

</script>
<br>
<button onmousedown="moveleft()" onmouseup="clearmove()" ontouchstart="moveleft()">Lewo</button>
<button onmousedown="moveright()" onmouseup="clearmove()" ontouchstart="moveright()">Prawo</button>
<button onmousedown="startGame()" onmouseup="clearmove()" ontouchstart="startGame()">Start</button>
<button onmousedown="pauseGame()" onmouseup="clearmove()" ontouchstart="pauseGame()">Stop</button>
<button onmousedown="toogleSidePlatform()" ontouchstart="pauseGame()">Switch side platform + Reset</button>

</body>
</html>